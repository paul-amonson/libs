<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JsonStore.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">libs</a> &gt; <a href="index.source.html" class="el_package">com.amonson.prop_store</a> &gt; <span class="el_source">JsonStore.java</span></div><h1>JsonStore.java</h1><pre class="source lang-java linenums">// Copyright (C) 2018-2019 Paul Amonson
//
// SPDX-License-Identifier: Apache-2.0
//

package com.amonson.prop_store;

import com.github.cliftonlabs.json_simple.JsonArray;
import com.github.cliftonlabs.json_simple.JsonException;
import com.github.cliftonlabs.json_simple.JsonObject;
import com.github.cliftonlabs.json_simple.Jsoner;

import java.util.Properties;

/**
 * PropStore implementation for JSON.
 */
class JsonStore extends PropStore {
    /**
     * Default constructor that takes a amp of configuration values for the property store.
     *
     * @param config The Properties of configuration parameters that may or may not be used by the derived classes.
     *              This may be null.
     */
    public JsonStore(Properties config) {
<span class="fc" id="L26">        super(config);</span>
<span class="fc" id="L27">    }</span>

    /**
     * Convert the PropMap to the text Store format.
     *
     * @param map The map to Store.
     * @return The String version of the PropMap.
     */
    @Override
    public String toString(PropMap map) {
<span class="fc" id="L37">        JsonObject json = new JsonObject(map);</span>
<span class="fc" id="L38">        return json.toJson();</span>
    }

    /**
     * Convert the PropList to the text Store format.
     *
     * @param list The list to Store.
     * @return The String version of the PropList.
     */
    @Override
    public String toString(PropList list) {
<span class="fc" id="L49">        JsonArray json = new JsonArray(list);</span>
<span class="fc" id="L50">        return json.toJson();</span>
    }

    /**
     * Convert a String representation of the properties to a PropMap.
     *
     * @param storeText The String representation of the properties.
     * @return The parsed PropMap.
     * @throws PropStoreException is thrown when the implementation cannot parse the text representation.
     */
    @Override
    public PropMap fromStringToMap(String storeText) throws PropStoreException {
        Object obj;
        try {
<span class="fc" id="L64">            obj = Jsoner.deserialize(storeText);</span>
<span class="fc" id="L65">        } catch(JsonException e) {</span>
<span class="fc" id="L66">            throw new PropStoreException(&quot;Failed to parse the text as JSON!&quot;, e);</span>
<span class="fc" id="L67">        }</span>
<span class="fc bfc" id="L68" title="All 2 branches covered.">        if(obj instanceof JsonObject)</span>
<span class="fc" id="L69">            return parseMap((JsonObject)obj);</span>
<span class="fc" id="L70">        throw new PropStoreException(&quot;The JSON text was not a map!&quot;);</span>
    }

    /**
     * Convert a String representation of the properties to a PropList.
     *
     * @param storeText The String representation of the properties.
     * @return The parsed PropList.
     * @throws PropStoreException is thrown when the implementation cannot parse the text representation.
     */
    @Override
    public PropList fromStringToList(String storeText) throws PropStoreException {
        Object obj;
        try {
<span class="fc" id="L84">            obj = Jsoner.deserialize(storeText);</span>
<span class="fc" id="L85">        } catch(JsonException e) {</span>
<span class="fc" id="L86">            throw new PropStoreException(&quot;Failed to parse the text as JSON!&quot;, e);</span>
<span class="fc" id="L87">        }</span>
<span class="fc bfc" id="L88" title="All 2 branches covered.">        if(obj instanceof JsonArray)</span>
<span class="fc" id="L89">            return parseArray((JsonArray)obj);</span>
<span class="fc" id="L90">        throw new PropStoreException(&quot;The JSON text was not a list!&quot;);</span>
    }

    private PropMap parseMap(JsonObject map) {
<span class="fc" id="L94">        PropMap result = new PropMap();</span>
<span class="fc bfc" id="L95" title="All 2 branches covered.">        for(String key: map.keySet()) {</span>
<span class="fc bfc" id="L96" title="All 2 branches covered.">            if(map.get(key) instanceof JsonObject)</span>
<span class="fc" id="L97">                result.put(key, parseMap((JsonObject)map.get(key)));</span>
<span class="fc bfc" id="L98" title="All 2 branches covered.">            else if(map.get(key) instanceof JsonArray)</span>
<span class="fc" id="L99">                result.put(key, parseArray((JsonArray)map.get(key)));</span>
            else
<span class="fc" id="L101">                result.put(key, map.get(key));</span>
<span class="fc" id="L102">        }</span>
<span class="fc" id="L103">        return result;</span>
    }

    private PropList parseArray(JsonArray array) {
<span class="fc" id="L107">        PropList result = new PropList();</span>
<span class="fc bfc" id="L108" title="All 2 branches covered.">        for (Object anArray : array) {</span>
<span class="fc bfc" id="L109" title="All 2 branches covered.">            if (anArray instanceof JsonObject)</span>
<span class="fc" id="L110">                result.add(parseMap((JsonObject)anArray));</span>
<span class="fc bfc" id="L111" title="All 2 branches covered.">            else if (anArray instanceof JsonArray)</span>
<span class="fc" id="L112">                result.add(parseArray((JsonArray)anArray));</span>
            else
<span class="fc" id="L114">                result.add(anArray);</span>
<span class="fc" id="L115">        }</span>
<span class="fc" id="L116">        return result;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>