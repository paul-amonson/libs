<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>YamlStore.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">libs</a> &gt; <a href="index.source.html" class="el_package">com.amonson.prop_store</a> &gt; <span class="el_source">YamlStore.java</span></div><h1>YamlStore.java</h1><pre class="source lang-java linenums">// Copyright (C) 2018-2019 Paul Amonson
//
// SPDX-License-Identifier: Apache-2.0
//

package com.amonson.prop_store;

import java.util.List;
import java.util.Map;
import java.util.Properties;

import org.yaml.snakeyaml.*;

/**
 * PropStore implementation for YAML.
 */
class YamlStore extends PropStore {
    /**
     * Default constructor that takes a amp of configuration values for the property store.
     *
     * @param config The Properties of configuration parameters that may or may not be used by the derived classes.
     *              This may be null.
     */
    public YamlStore(Properties config) {
<span class="fc" id="L25">        super(config);</span>
<span class="fc" id="L26">        int indent = 2;</span>
<span class="fc bfc" id="L27" title="All 2 branches covered.">        if(config != null)</span>
<span class="fc" id="L28">            indent = Integer.parseInt(config.getProperty(&quot;com.amonson.prop_store.indent&quot;, &quot;2&quot;));</span>
<span class="fc" id="L29">        DumperOptions options = new DumperOptions();</span>
<span class="fc" id="L30">        options.setIndent(indent);</span>
<span class="fc" id="L31">        options.setPrettyFlow(true);</span>
<span class="fc" id="L32">        options.setExplicitStart(true);</span>
<span class="fc" id="L33">        options.setDefaultFlowStyle(DumperOptions.FlowStyle.BLOCK);</span>
<span class="fc" id="L34">        store_ = new Yaml(options);</span>
<span class="fc" id="L35">    }</span>

    /**
     * Convert the PropMap to the text Store format.
     *
     * @param map The map to Store.
     * @return The String version of the PropMap.
     */
    @Override
    public String toString(PropMap map) {
<span class="fc" id="L45">        return store_.dump(map);</span>
    }

    /**
     * Convert the PropList to the text Store format.
     *
     * @param list The list to Store.
     * @return The String version of the PropList.
     */
    @Override
    public String toString(PropList list) {
<span class="fc" id="L56">        return store_.dump(list);</span>
    }

    /**
     * Convert a String representation of the properties to a PropMap.
     *
     * @param storeText The String representation of the properties.
     * @return The parsed PropMap.
     * @throws PropStoreException is thrown when the implementation cannot parse the text representation.
     */
    @Override
    public PropMap fromStringToMap(String storeText) throws PropStoreException {
<span class="fc" id="L68">        return parseMap(store_.load(storeText));</span>
    }

    /**
     * Convert a String representation of the properties to a PropList.
     *
     * @param storeText The String representation of the properties.
     * @return The parsed PropList.
     * @throws PropStoreException is thrown when the implementation cannot parse the text representation.
     */
    @Override
    public PropList fromStringToList(String storeText) throws PropStoreException {
<span class="fc" id="L80">        return parseArray(store_.load(storeText));</span>
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    private PropMap parseMap(Map&lt;? extends String, ?&gt; map) {
<span class="fc" id="L85">        PropMap result = new PropMap();</span>
<span class="fc bfc" id="L86" title="All 2 branches covered.">        for(String key: map.keySet()) {</span>
<span class="fc bfc" id="L87" title="All 2 branches covered.">            if(map.get(key) instanceof Map)</span>
<span class="fc" id="L88">                result.put(key, parseMap((Map&lt;String,Object&gt;)map.get(key)));</span>
<span class="fc bfc" id="L89" title="All 2 branches covered.">            else if(map.get(key) instanceof List)</span>
<span class="fc" id="L90">                result.put(key, parseArray((List&lt;Object&gt;)map.get(key)));</span>
            else
<span class="fc" id="L92">                result.put(key, map.get(key));</span>
<span class="fc" id="L93">        }</span>
<span class="fc" id="L94">        return result;</span>
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    private PropList parseArray(List&lt;?&gt; array) {
<span class="fc" id="L99">        PropList result = new PropList();</span>
<span class="fc bfc" id="L100" title="All 2 branches covered.">        for (Object anArray : array) {</span>
<span class="fc bfc" id="L101" title="All 2 branches covered.">            if (anArray instanceof Map)</span>
<span class="fc" id="L102">                result.add(parseMap((Map&lt;String, Object&gt;)anArray));</span>
<span class="fc bfc" id="L103" title="All 2 branches covered.">            else if (anArray instanceof List)</span>
<span class="fc" id="L104">                result.add(parseArray((List&lt;Object&gt;)anArray));</span>
            else
<span class="fc" id="L106">                result.add(anArray);</span>
<span class="fc" id="L107">        }</span>
<span class="fc" id="L108">        return result;</span>
    }

    private Yaml store_;
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>